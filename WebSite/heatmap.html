<?php
   require('Connect.php');

   session_Start();
   
   //If the user has no favorite currencies
   if($_SESSION['cryptoList'][0] == ''){
     $_SESSION['error'] = 'User has no favorite currencies!';
   }

   //User has selected a currency
   else{
     //Clear any previous results
     $_SESSION['results'] = '';

     //Loop through each currency in the user's wallet
     foreach ($_SESSION['cryptoList'] as &$val){

       //Go do query magic
       $temp = doQuery($value);
       
       $_SESSION['results'] = array_merge($_SESSION['results'],$temp);
     }

     unset($val);
   }

   function doQuery($name){
     $database = new Oci;
     $database->connect();

     if(!$database->isConnected){
       $_SESSION['error'] = "Connection Timed Out";
     }
     else{
       $database->parseQuery("Select max(volume24hr) from
       Howerter.monetaryValue m inner join Howerter.cryptocurrency c ON
       m.cryptonameid_fk = c.cryptonameid and c.cryptocoinname = :id_bv;")
       
       oci_bind_by_name($database->stid, ":id_bv", $name);

       if(!$database->stid){
         $_SESSION['error'] = 'Could not parse database query';
         exit;
       }

       oci_execute($databse->stid);

       $array = array();

       while($row = oci_fetch_array($database->stid, OCI_ASSOC+OCI_RETURN_NULLS)){

         $array[] = $row;
       }

       return $array;
   }

?>

ï»¿<!DOCTYPE html>
<html>
  <head>
      <script src="JavaScript/Chart.bundle.js"></script>
      <script src="JavaScript/Chart.bundle.min.js"></script>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width">
      <meta name="description" content="CIS4301 Spring 2018 Group 3 Project">
      <meta name="keywords" content="crypto currency">
      <meta name="author" content="Doug Masini, Michael Howerter, Nicolas Werner">
      <title>Crypto Currency Database | Heat Map</title>
    <link rel="stylesheet" href="./css/style.css">
  </head>
<body>
    <header>
        <div class="container">
            <div id="branding">
                <h1><span class="highlight">Cryptocurrency Database</span></h1>
            </div>
            <nav>
                <ul>
                    <li><a href="dashboard.html">Home</a></li>
                    <li><a href="compare.html">Compare</a></li>
                    <li><a href="archive.html">Archive</a></li>
                    <li class="current"><a href="heatmap.html">Heat Map</a></li>
                    <li><a href="welcome.html">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section id="main">
        <div class="container">
            <article id="main-col">
                <h1 class="page-title">Cryptocurrency Heat Map</h1>
                <canvas id="myChart" width="800" height="400"></canvas>
                <script>
                var ctx = document.getElementById("myChart").getContext("2d");
                var myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ["1", "2", "3", "4", "5", "6"],
                        datasets: [{
                            label: 'Currency Values',
                            data: [12, 19, 3, 5, 2, 3],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(255, 206, 86, 0.2)',
                                'rgba(75, 192, 192, 0.2)',
                                'rgba(153, 102, 255, 0.2)',
                                'rgba(255, 159, 64, 0.2)'
                            ],
                            borderColor: [
                                'rgba(255,99,132,1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero:true
                                }
                            }]
                        }
                    }
                   });
                </script> 
            </article>
        </div>
    </section>

    <footer>
        <p>CIS4301 Spring 2018 Group 3 Project. Created by: Doug Masini, Michael Howerter, Nicolas Werner</p>
    </footer>
</body>
</html>
